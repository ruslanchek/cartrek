(function(c){var b=0;c.fn.datepicker=function(d){return this.each(function(){var e=new a(this,d);e.init()})};function a(e,d){this.opts=c.extend({lang:"ru",theme:"realistic",effect:"fade",callback:false,embed:false,onlytrigger:false,trigger:false,setDate:false,format:"dd.mm.yy",today:false,close:false,date:false,daysInMonth:[0,31,28,31,30,31,30,31,31,30,31,30,31],dateRegexp:/^(.*?)(\/|\.|\-)(.*?)(?:\/|\.|\-)(.*?)$/,splitter:".",month:false,day:false,year:false,current_day:false,current_month:false,current_year:false,prev_day:false,prev_month:false,prev_year:false,next_day:false,next_month:false,next_year:false,today_day:false,today_month:false,today_year:false,langToday:{fr:"Aujourd'hui",en:"Today",es:"Hoy",it:"Oggi",de:"Heute",pt:"Hoje",ru:"Сегодня"},langClose:{fr:"Fermer",en:"Close",es:"Cerrar",it:"Chiudi",de:"Schließen",pt:"Fechar",ru:"Закрыть"},langDays:{fr:["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"],en:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],es:["Lun","Mar","Mie","Jue","Vie","S&#224;b","Dom"],it:["Lun","Mar","Mer","Gio","Ven","Sab","Dom"],de:["Mon","Die","Mit","Don","Fre","Sam","Son"],pt:["Seg","Ter","Qua","Qui","Sex","S&#225;","Dom"],ru:["Пн","Вт","Ср","Чт","Пт","Сб","Вс"]},langMonth:{fr:["","Janvier","F&#233;vrier","Mars","Avril","Mai","Juin","Juillet","Aout","Septembre","Octobre","Novembre","D&#233;cembre"],en:["","January","February","March","April","May","June","July","August","September","October","November","December"],es:["","Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],it:["","Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"],de:["","Januar","Februar","M&#228;rz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],pt:["","Janeiro","Fevereiro","Mar&#231;o","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],ru:["","Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"]}},d);this.$el=c(e)}a.prototype={init:function(){this.closeHandler=function(f){this.close(f)}.bind2(this);var d=new Date();this.opts.today_year=d.getFullYear();this.opts.today_month=this._leftpad_zero(d.getMonth()+1);this.opts.today_day=this._leftpad_zero(d.getDate());this.opts.index=b;if(this.opts.setDate!==false&&typeof(this.opts.setDate)!="function"){this.opts.date=this.opts.setDate}this.build();if(this.opts.onlytrigger){this.opts.trigger=this.$el}if(this.opts.embed===false){if(this.opts.trigger===false){this.$el.addClass("kube_datepicker_trigger").attr("rel",b).click(function(f){this.open(f)}.bind2(this))}else{c(this.opts.trigger).addClass("kube_datepicker_trigger").attr("rel",b).click(function(f){this.open(f)}.bind2(this))}}else{this.draw()}b++},build:function(){this.$datepicker_box=c('<div class="kube_datepicker">').attr("id","kube_datepicker"+this.opts.index).addClass("kube_datepicker_theme_"+this.opts.theme).attr("rel",this.opts.index).hide();if(this.opts.embed){this.$datepicker_box.addClass("kube_datepicker_embed")}this.$datepicker_wrapper=c('<div class="kube_datepicker_wrapper">');this.$datepicker_box.append(this.$datepicker_wrapper);this.$datepicker_header=c('<div class="kube_datepicker_header">');this.$datepicker_prev=c('<a href="javascript:void(null);" class="kube_datepicker_prev"></a>').html("&lt;").click(function(f){return this.setPrevMonth(f)}.bind2(this));this.$datepicker_next=c('<a href="javascript:void(null);" class="kube_datepicker_next"></a>').html("&gt;").click(function(f){return this.setNextMonth(f)}.bind2(this));this.$datepicker_monthname=c('<div class="kube_datepicker_monthname">');var e=c('<div  class="kube_datepicker_top1">');var d=c('<div  class="kube_datepicker_top2">');this.$datepicker_header.append(e);this.$datepicker_header.append(d);this.$datepicker_header.append(this.$datepicker_prev);this.$datepicker_header.append(this.$datepicker_next);this.$datepicker_header.append(this.$datepicker_monthname);this.$datepicker_wrapper.append(this.$datepicker_header);this.$datepicker_table=c('<table class="kube_datepicker_table">');this.$datepicker_table_head=c("<thead>");this.$datepicker_table_body=c("<tbody>");this.$datepicker_table.append(this.$datepicker_table_head);this.$datepicker_table.append(this.$datepicker_table_body);this.$datepicker_wrapper.append(this.$datepicker_table);this.$datepicker_footer_wrap=c('<div class="kube_datepicker_footer_wrap">');this.$datepicker_footer=c('<div class="kube_datepicker_footer">');if(this.opts.today){this.$datepicker_today=c('<a href="javascript:void(null);">'+this.opts.langToday[this.opts.lang]+"</a>");this.$datepicker_today.click(function(){this.setTodayMonth()}.bind2(this));this.$datepicker_footer.append(this.$datepicker_today)}if(this.opts.close&&this.opts.embed===false){this.$datepicker_close=c('<a href="javascript:void(null);">'+this.opts.langClose[this.opts.lang]+"</a>");this.$datepicker_close.click(function(){this.close(false)}.bind2(this));this.$datepicker_footer.append(this.$datepicker_close)}this.$datepicker_footer_wrap.append(this.$datepicker_footer);this.$datepicker_wrapper.append(this.$datepicker_footer_wrap);if(this.opts.embed){this.$el.append(this.$datepicker_box);this.$datepicker_box.show()}else{c(document.body).append(this.$datepicker_box)}},draw:function(){this.parseDate();this.grid();this.setGridMonth()},open:function(h){if(h.preventDefault){h.preventDefault()}var g=c(h.target).attr("rel");c(".kube_datepicker").not(".kube_datepicker_embed").hide();this.$datepicker_box=c("#kube_datepicker"+g);this.draw();if(this.opts.trigger===false){var q=this.$el}else{var q=c(this.opts.trigger)}var m=q.offset();var p=this.$datepicker_box.outerWidth();var d=this.$datepicker_box.outerHeight();var f=q.width();var r=q.outerHeight();var o=c(document).width()-m.left-f;var l=c(document).height()-m.top-r;if(l<d){var k=(m.top-d-r)+"px"}else{var k=(m.top+r)+"px"}if(o<p){var n="auto";var j=o+"px"}else{var n=m.left+"px";var j="auto"}this.$datepicker_box.css({top:k,left:n,right:j});if(this.opts.effect===false){this.$datepicker_box.show()}else{if(this.opts.effect=="slide"){this.$datepicker_box.slideDown()}else{if(this.opts.effect=="fade"){this.$datepicker_box.fadeIn()}}}c(document).click(this.closeHandler)},grid:function(){this.$datepicker_table_head.html("");var m=c("<tr>");c.each(this.opts.langDays[this.opts.lang],function(d,r){var t=c("<th>").html(r);m.append(t)});this.$datepicker_table_head.append(m);var q=this.getDaysCurrentMonth();var g=this.getDaysPrevMonth();var j=this.getDaysNextMonth();var k=new Date(this.opts.year,this.opts.month-1,1);var p=(!k.getDay())?7:k.getDay();var h=g-p+2;var e=8-p;this.$datepicker_table_body.html("");var o=1,l=1;for(z=0;z<6;z++){var m=c("<tr>");for(i=0;i<7;i++){if(z==0){var f=h+i;if(f>g){var n={num:o,last:false,year:this.opts.current_year,month:this.opts.current_month,date:this.getGridDay(this.opts.current_year,this.opts.current_month,o),select:this.checkSelectDate(this.opts.current_year,this.opts.current_month,o),today:this.checkTodayDate(this.opts.current_year,this.opts.current_month,o)};o++}else{var n={num:f,last:true,year:this.opts.prev_year,month:this.opts.prev_month,date:this.getGridDay(this.opts.prev_year,this.opts.prev_month,f),select:this.checkSelectDate(this.opts.prev_year,this.opts.prev_month,f),today:this.checkTodayDate(this.opts.prev_year,this.opts.prev_month,f)}}}else{if(o>q){var n={num:l,last:true,year:this.opts.next_year,month:this.opts.next_month,date:this.getGridDay(this.opts.next_year,this.opts.next_month,l),select:this.checkSelectDate(this.opts.next_year,this.opts.next_month,l),today:this.checkTodayDate(this.opts.next_year,this.opts.next_month,l)};l++}else{var n={num:o,last:false,year:this.opts.current_year,month:this.opts.current_month,date:this.getGridDay(this.opts.current_year,this.opts.current_month,o),select:this.checkSelectDate(this.opts.current_year,this.opts.current_month,o),today:this.checkTodayDate(this.opts.current_year,this.opts.current_month,o)};o++}}m.append(this.setGridDay(n))}this.$datepicker_table_body.append(m)}},parseDate:function(){var e=this.$el.get(0).tagName;if(typeof(this.opts.setDate)=="function"){this.opts.date=this.opts.setDate()}else{if(this.opts.setDate===false&&this.opts.embed===false&&this.opts.onlytrigger==false){if(e=="INPUT"||e=="TEXTAREA"){this.opts.date=c.trim(this.$el.val())}else{this.opts.date=c.trim(this.$el.html())}}}if(this.opts.date==""){this.getTodayDate()}var d=this.opts.date.match(this.opts.dateRegexp);var f=this.opts.format.match(this.opts.dateRegexp);this.opts.splitter=d[2];c.each(f,function(g,h){if(h=="mm"){this.opts.month=this._leftpad_zero(d[g])}else{if(h=="yy"){this.opts.year=d[g]}else{if(h=="dd"){this.opts.day=this._leftpad_zero(d[g])}}}}.bind2(this));this.opts.current_year=this.opts.year;this.opts.current_month=this.opts.month;this.opts.current_day=this.opts.day;this._setPrev();this._setNext()},getFormatDate:function(f,g,d){var e=new Date(f,g-1,d);return this.replaceFormatDate(e.getFullYear(),this._leftpad_zero(e.getMonth()+1),e.getDate())},replaceFormatDate:function(f,g,e){var d=this.opts.format.replace("dd",this._add_zero(e));d=d.replace("mm",this._add_zero(g));return d.replace("yy",f)},getTodayDate:function(){var d=this.opts.format.replace("dd",this.opts.today_day);d=d.replace("mm",this.opts.today_month);this.opts.date=d.replace("yy",this.opts.today_year);return this.opts.date},setGridMonth:function(){this.$datepicker_monthname.html(this.opts.langMonth[this.opts.lang][this.opts.current_month]+" "+this.opts.current_year)},checkSelectDate:function(e,f,d){if(this.opts.year==e&&this.opts.month.toString()==f.toString()&&this.opts.day==d){return true}else{return false}},checkTodayDate:function(e,f,d){if(this.opts.today_year==e&&this.opts.today_month.toString()==f.toString()&&this.opts.today_day==d){return true}else{return false}},getGridDay:function(e,f,d){return this.replaceFormatDate(e,f,d)},setGridDay:function(e){var f=c("<td>");if(e.last){f.addClass("kube_datepicker_day_last")}if(e.today){f.addClass("kube_datepicker_day_today")}if(e.select){f.addClass("kube_datepicker_day_select")}var d=c('<a href="javascript:void(null);" title="'+e.date+'">'+e.num+"</a>").click(function(g){this.callback(g,e.date,e.year,e.month,e.num)}.bind2(this));return f.append(d)},callback:function(k,f,h,j,d){if(this.opts.embed===false&&this.opts.onlytrigger===false){var g=this.$el.get(0).tagName;this.opts.date=f;if(g=="INPUT"||g=="TEXTAREA"){this.$el.val(f)}else{this.$el.html(f)}this.close(false)}if(this.opts.onlytrigger!==false){this.close(false)}if(this.opts.callback){this.opts.callback(k,f,h,j,d)}},close:function(d){if(d!==false){if(c(d.target).hasClass("kube_datepicker_trigger")){return false}if(c(d.target).attr("id")=="kube_datepicker"+this.opts.index){return false}else{if(c(d.target).parents("#kube_datepicker"+this.opts.index).size()!=0){return false}}}if(this.opts.embed===false){if(this.opts.effect===false){c("#kube_datepicker"+this.opts.index).hide()}else{if(this.opts.effect=="slide"){c("#kube_datepicker"+this.opts.index).slideUp()}else{if(this.opts.effect=="fade"){c("#kube_datepicker"+this.opts.index).fadeOut()}}}c(document).unbind("click",this.closeHandler)}},updateGrid:function(){this.grid();this.setGridMonth()},setTodayMonth:function(){var d=new Date();this.opts.current_year=d.getFullYear();this.opts.current_month=this._leftpad_zero(d.getMonth()+1);this._setPrev();this._setNext();this.updateGrid()},setCurrentMonth:function(){var d=new Date(this.opts.current_year,this.opts.current_month,1);this.opts.current_year=d.getFullYear();this.opts.current_month=this._leftpad_zero(d.getMonth());this._setPrev();this._setNext();this.updateGrid()},setPrevMonth:function(g){if(g.preventDefault){g.preventDefault()}var d=new Date(this.opts.current_year,this.opts.current_month-1,1);var f=d.getMonth();this.opts.current_year=d.getFullYear();if(f==0){f=12;this.opts.current_year--}this.opts.current_month=this._leftpad_zero(f);this._setPrev();this._setNext();this.updateGrid();return false},setNextMonth:function(g){if(g.preventDefault){g.preventDefault()}var d=new Date(this.opts.current_year,this.opts.current_month+1,1);var f=d.getMonth();this.opts.current_year=d.getFullYear();if(f==0){f=12;this.opts.current_year--}this.opts.current_month=this._leftpad_zero(f);this._setPrev();this._setNext();this.updateGrid();return false},_setPrev:function(){var d=this.getPrevMonthYear(this.opts.current_year,this.opts.current_month);this.opts.prev_year=d[0];this.opts.prev_month=d[1]},_setNext:function(){var d=this.getNextMonthYear(this.opts.current_year,this.opts.current_month);this.opts.next_year=d[0];this.opts.next_month=d[1]},getDaysCurrentMonth:function(){return this.getMonthDays(this.opts.current_year,this.opts.current_month)},getDaysPrevMonth:function(){return this.getMonthDays(this.opts.prev_year,this.opts.prev_month)},getDaysNextMonth:function(){return this.getMonthDays(this.opts.next_year,this.opts.next_month)},getMonthDays:function(d,e){if(((0==(d%4))&&((0!=(d%100))||(0==(d%400))))&&(e==1)){return 29}return this.opts.daysInMonth[e]},getPrevMonthYear:function(e,g){var f=this._leftpad_zero(g)-1;var d=e;if(f<=0){f=12;d--}return[d,f]},getNextMonthYear:function(e,g){var f=this._leftpad_zero(g)+1;var d=e;if(f>12){f=1;d++}return[d,f]},_add_zero:function(d){d=new Number(d);if(d<10){return"0"+d}else{return d}},_leftpad_zero:function(d){return new Number(d)}};Function.prototype.bind2=function(e){var f=this;var d=c.makeArray(arguments).slice(1);return function(h){if(h==new Object){f=null;d=null}else{if(f==null){throw"Attempt to invoke destructed method reference."}else{var g=c.makeArray(arguments);return f.apply(e,d.concat(g))}}}}})(jQuery);