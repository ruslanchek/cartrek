server {
	listen 80;
	
	server_name cartrek.ru;
	root /home/cartrek/www/cartrek.ru;

	access_log /home/cartrek/www/logs/cartrek.ru.nginx.SSL.access.log;
	error_log /home/cartrek/www/logs/cartrek.ru.nginx.SSL.error.log;

	client_max_body_size 30M;
	
	location /control {
		proxy_pass 	http://127.0.0.1:8080;
	}
}

server {
    listen       80;
    server_name  control.cartrek.ru;
    return       301 https://control.cartrek.ru$request_uri;
}

server {
	listen 443;

	ssl         on;
	ssl_protocols       SSLv3 TLSv1;
	ssl_certificate     /etc/ssl/certs/cartrek_ru.crt;
	ssl_certificate_key /etc/ssl/private/cartrek_ru.key;
	
	server_name control.cartrek.ru;
	root /home/carerek/www/control.cartrek.ru;

	access_log /home/cartrek/www/logs/control.cartrek.ru.nginx.SSL.access.log;
	error_log /home/cartrek/www/logs/control.cartrek.ru.nginx.SSL.error.log;

	client_max_body_size 30M;
	
	location /control {
		proxy_pass http://127.0.0.1:8080;
		expires           0;
    	add_header        Cache-Control private;
	}

	location / {
		rewrite ^(/)(.*)$ https://control.cartrek.ru/control permanent;
	}
}